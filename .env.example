# =============================================================================
# STORIES BACKEND ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env and update values for your environment

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
PORT=8080
GIN_MODE=debug
API_PREFIX=/api/v1
TRUSTED_PROXIES=127.0.0.1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
DATABASE_URL=postgresql://stories_user:stories_pass@localhost:5432/stories_db?sslmode=disable
DB_MAX_OPEN_CONNS=50
DB_MAX_IDLE_CONNS=10
DB_MAX_LIFETIME=1800s

# Database Migration
MIGRATE_TIMEOUT=300s
MIGRATE_LOCK_TIMEOUT=60s

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=
REDIS_DB=0
REDIS_MAX_RETRIES=3
REDIS_MIN_RETRY_BACKOFF=8ms
REDIS_MAX_RETRY_BACKOFF=512ms
REDIS_DIAL_TIMEOUT=5s
REDIS_READ_TIMEOUT=3s
REDIS_WRITE_TIMEOUT=3s
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=5
REDIS_POOL_TIMEOUT=4s
REDIS_IDLE_TIMEOUT=300s
REDIS_IDLE_CHECK_FREQUENCY=60s

# =============================================================================
# JWT CONFIGURATION
# =============================================================================
JWT_SECRET=your-super-secure-256-bit-jwt-secret-change-in-production
JWT_REFRESH_SECRET=your-super-secure-256-bit-refresh-secret-change-in-production
JWT_EXPIRY_HOURS=24
JWT_REFRESH_EXPIRY_DAYS=7
JWT_ISSUER=stories-backend
JWT_AUDIENCE=stories-app

# =============================================================================
# MINIO/S3 CONFIGURATION
# =============================================================================
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=stories-media
MINIO_USE_SSL=false
MINIO_REGION=us-east-1
PRESIGNED_URL_EXPIRY_MINUTES=15

# Alternative S3 Configuration
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-west-2
S3_BUCKET=your-stories-bucket

# =============================================================================
# STORY CONFIGURATION
# =============================================================================
STORY_DEFAULT_EXPIRY_HOURS=24
STORY_MAX_EXPIRY_HOURS=168
STORY_MIN_EXPIRY_HOURS=1
STORY_MAX_TEXT_LENGTH=2000
STORY_MAX_FILE_SIZE_MB=10
STORY_ALLOWED_TYPES=text,image,video

# =============================================================================
# USER CONFIGURATION
# =============================================================================
USER_MAX_USERNAME_LENGTH=30
USER_MIN_USERNAME_LENGTH=3
USER_MAX_BIO_LENGTH=500
USER_MAX_FULL_NAME_LENGTH=100
USER_REGISTRATION_ENABLED=true
USER_EMAIL_VERIFICATION_REQUIRED=true

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10
RATE_LIMIT_ENABLED=true

# Per-endpoint rate limits
RATE_LIMIT_LOGIN_PER_MINUTE=5
RATE_LIMIT_SIGNUP_PER_MINUTE=3
RATE_LIMIT_STORY_CREATE_PER_MINUTE=10
RATE_LIMIT_FOLLOW_PER_MINUTE=20

# =============================================================================
# WORKER CONFIGURATION
# =============================================================================
WORKER_POLL_INTERVAL=30s
WORKER_BATCH_SIZE=100
WORKER_MAX_RETRIES=3
WORKER_TIMEOUT=300s

# Story expiration worker
EXPIRATION_WORKER_ENABLED=true
EXPIRATION_WORKER_INTERVAL=60s
EXPIRATION_WORKER_BATCH_SIZE=1000

# Queue worker
QUEUE_WORKER_ENABLED=true
QUEUE_WORKER_CONCURRENCY=5

# =============================================================================
# MONITORING AND METRICS
# =============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_PATH=/metrics
HEALTH_CHECK_PATH=/health

# Metrics collection
COLLECT_DB_METRICS=true
COLLECT_REDIS_METRICS=true
COLLECT_HTTP_METRICS=true
COLLECT_CUSTOM_METRICS=true

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOWED_HEADERS=Origin,Content-Type,Accept,Authorization,X-Requested-With
CORS_EXPOSE_HEADERS=Content-Length,X-Total-Count
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=86400

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_LEVEL=info
LOG_FORMAT=json
LOG_OUTPUT=stdout
LOG_ENABLE_CALLER=true
LOG_ENABLE_STACKTRACE=true

# File logging (optional)
LOG_FILE_ENABLED=false
LOG_FILE_PATH=./logs/app.log
LOG_FILE_MAX_SIZE=100
LOG_FILE_MAX_BACKUPS=3
LOG_FILE_MAX_AGE=28
LOG_FILE_COMPRESS=true

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
BCRYPT_COST=12
SESSION_TIMEOUT=24h
MAX_LOGIN_ATTEMPTS=5
LOGIN_ATTEMPT_WINDOW=15m
ACCOUNT_LOCKOUT_DURATION=1h

# Password requirements
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true

# =============================================================================
# EMAIL CONFIGURATION (Optional)
# =============================================================================
EMAIL_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
EMAIL_FROM=noreply@yourdomain.com
EMAIL_FROM_NAME=Stories App

# Email templates
EMAIL_TEMPLATES_DIR=./templates/emails
EMAIL_VERIFICATION_TEMPLATE=verify-email.html
PASSWORD_RESET_TEMPLATE=password-reset.html

# =============================================================================
# WEBSOCKET CONFIGURATION
# =============================================================================
WS_READ_BUFFER_SIZE=1024
WS_WRITE_BUFFER_SIZE=1024
WS_HANDSHAKE_TIMEOUT=10s
WS_WRITE_WAIT=10s
WS_PONG_WAIT=60s
WS_PING_PERIOD=54s
WS_MAX_MESSAGE_SIZE=512

# =============================================================================
# CACHE CONFIGURATION
# =============================================================================
CACHE_TTL_USER=300s
CACHE_TTL_STORY=180s
CACHE_TTL_FEED=60s
CACHE_TTL_ANALYTICS=900s

# Cache prefixes
CACHE_PREFIX_USER=user:
CACHE_PREFIX_STORY=story:
CACHE_PREFIX_FEED=feed:
CACHE_PREFIX_SESSION=session:

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_STORY_REACTIONS=true
FEATURE_STORY_VIEWS=true
FEATURE_USER_FOLLOW=true
FEATURE_REAL_TIME_NOTIFICATIONS=true
FEATURE_ANALYTICS=true
FEATURE_MEDIA_UPLOAD=true
FEATURE_EMAIL_NOTIFICATIONS=false
FEATURE_PUSH_NOTIFICATIONS=false

# =============================================================================
# DEVELOPMENT CONFIGURATION
# =============================================================================
DEBUG=true
ENABLE_PPROF=false
PPROF_ADDR=localhost:6060

# Test database (for running tests)
TEST_DATABASE_URL=postgresql://stories_user:stories_pass@localhost:5432/stories_test_db?sslmode=disable

# =============================================================================
# PRODUCTION OVERRIDES
# =============================================================================
# Uncomment and set these for production deployments

# ENVIRONMENT=production
# GIN_MODE=release
# DEBUG=false
# LOG_LEVEL=warn
# RATE_LIMIT_REQUESTS_PER_MINUTE=120
# JWT_EXPIRY_HOURS=1
# MINIO_USE_SSL=true
# CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
# EMAIL_ENABLED=true
# FEATURE_EMAIL_NOTIFICATIONS=true

# =============================================================================
# KUBERNETES/CONTAINER CONFIGURATION
# =============================================================================
# These are typically set by the orchestration platform

# KUBERNETES_NAMESPACE=stories-backend
# POD_NAME=stories-api-pod
# SERVICE_ACCOUNT=stories-backend-sa
# CONFIG_MAP_NAME=stories-backend-config
# SECRET_NAME=stories-backend-secret

# Health check configuration
# HEALTH_CHECK_ENABLED=true
# READINESS_CHECK_PATH=/health/ready
# LIVENESS_CHECK_PATH=/health/live

# =============================================================================
# EXTERNAL SERVICES
# =============================================================================
# Add configuration for external services like analytics, monitoring, etc.

# Sentry (Error tracking)
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_RELEASE=

# New Relic (APM)
NEW_RELIC_LICENSE_KEY=
NEW_RELIC_APP_NAME=Stories Backend

# Datadog (Monitoring)
DD_API_KEY=
DD_APP_KEY=
DD_ENV=development
DD_SERVICE=stories-backend
DD_VERSION=1.0.0

# =============================================================================
# MISCELLANEOUS
# =============================================================================
TIMEZONE=UTC
MAX_REQUEST_SIZE=32MB
REQUEST_TIMEOUT=30s
GRACEFUL_SHUTDOWN_TIMEOUT=30s

# File upload configuration
UPLOAD_MAX_SIZE=10MB
UPLOAD_ALLOWED_TYPES=image/jpeg,image/png,image/gif,video/mp4,video/quicktime

# Pagination defaults
DEFAULT_PAGE_SIZE=20
MAX_PAGE_SIZE=100

# API versioning
API_VERSION=v1
API_DEPRECATION_NOTICE=false

# Development tools
ENABLE_SWAGGER=false
SWAGGER_HOST=localhost:8080
SWAGGER_BASE_PATH=/api/v1
